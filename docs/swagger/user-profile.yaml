openapi: 3.0.0
info:
  title: User Profile API
  version: 1.0.0
  description: User profile management with photo upload

servers:
  - url: http://localhost:5000/api
    description: Local development server
  - url: https://api.ticportal.org/api
    description: Production server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserProfile:
      type: object
      properties:
        id:
          type: string
          example: "507f1f77bcf86cd799439011"
        email:
          type: string
          format: email
          example: "johndoe@example.com"
        username:
          type: string
          example: "johndoe"
        firstName:
          type: string
          example: "John"
        lastName:
          type: string
          example: "Doe"
        bio:
          type: string
          example: "Software developer passionate about tech"
        phone:
          type: string
          example: "+1234567890"
        profilePhoto:
          type: string
          format: uri
          example: "https://utfs.io/f/abc123.jpg"
        school:
          type: string
          example: "Tech University"
        grade:
          type: string
          example: "Senior"
        country:
          type: string
          example: "USA"
        gradDate:
          type: string
          format: date-time
          example: "2026-05-15T00:00:00.000Z"
        role:
          type: string
          enum: [STUDENT, MENTOR, JUDGE, SQUAD_LEAD, ADMIN, SUPER_ADMIN]
          example: "STUDENT"
        isVerified:
          type: boolean
          example: true
        lastLogin:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    UpdateProfileRequest:
      type: object
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 30
          example: "johndoe"
        firstName:
          type: string
          example: "John"
        lastName:
          type: string
          example: "Doe"
        bio:
          type: string
          maxLength: 500
          example: "Software developer passionate about tech education"
        phone:
          type: string
          example: "+1234567890"
        school:
          type: string
          example: "MIT"
        grade:
          type: string
          example: "Senior"
        country:
          type: string
          example: "USA"
        gradDate:
          type: string
          format: date-time
          example: "2026-05-15T00:00:00.000Z"

    UpdateProfilePhotoRequest:
      type: object
      required:
        - profilePhoto
      properties:
        profilePhoto:
          type: string
          format: byte
          description: Base64 encoded image with data URL prefix (data:image/jpeg;base64,...)
          example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEA..."

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Validation error"
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

paths:
  /users/profile:
    get:
      tags:
        - User Profile
      summary: Get user profile
      description: Retrieve the authenticated user's profile information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '401':
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - User Profile
      summary: Update user profile
      description: Update the authenticated user's profile information
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
            examples:
              basic:
                summary: Basic profile update
                value:
                  username: "johndoe"
                  bio: "Tech enthusiast"
                  school: "MIT"
              full:
                summary: Full profile update
                value:
                  username: "johndoe"
                  firstName: "John"
                  lastName: "Doe"
                  bio: "Software developer passionate about tech education"
                  phone: "+1234567890"
                  school: "Tech University"
                  grade: "Senior"
                  country: "USA"
                  gradDate: "2026-05-15T00:00:00.000Z"
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidUsername:
                  summary: Invalid username
                  value:
                    success: false
                    message: "Username must be between 3 and 30 characters"
                bioTooLong:
                  summary: Bio too long
                  value:
                    success: false
                    message: "Bio must not exceed 500 characters"
        '409':
          description: Conflict - Username already taken
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Username already taken"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/profile-photo:
    put:
      tags:
        - User Profile
      summary: Update profile photo
      description: Upload a new profile photo (base64 encoded)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfilePhotoRequest'
            example:
              profilePhoto: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."
      responses:
        '200':
          description: Profile photo updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserProfile'
              example:
                success: true
                data:
                  id: "507f1f77bcf86cd799439011"
                  profilePhoto: "https://utfs.io/f/profile-507f1f77bcf86cd799439011-1735992000.jpg"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidFormat:
                  summary: Invalid image format
                  value:
                    success: false
                    message: "Invalid image format. Only PNG, JPEG, and GIF are allowed"
                tooLarge:
                  summary: Image too large
                  value:
                    success: false
                    message: "Image size (5.2MB) exceeds 4MB limit"
                invalidBase64:
                  summary: Invalid base64
                  value:
                    success: false
                    message: "Invalid base64 format"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - User Profile
      summary: Delete profile photo
      description: Remove the user's profile photo
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile photo deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: No profile photo to delete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "No profile photo to delete"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
